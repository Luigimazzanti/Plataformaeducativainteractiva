â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš¨ SOLUCIÃ“N INMEDIATA - ERROR IA GENERADOR DE PREGUNTAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA:
--------
- Error 401: "Missing authorization header"
- Error 504: Timeout en peticiones OPTIONS (150 segundos)
- El generador de preguntas con IA de Gemini NO funciona

CAUSA RAÃZ:
-----------
El archivo principal del servidor estÃ¡ en formato .TSX cuando Supabase Edge Functions 
SOLO acepta archivos .TS (TypeScript puro, NO React TypeScript)

Archivo actual:  /supabase/functions/server/index.tsx âŒ
Debe ser:        /supabase/functions/server/index.ts  âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SOLUCIÃ“N - 3 PASOS SIMPLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: Descargar el archivo actual
------------------------------------
1. Ve a: Supabase Dashboard â†’ Edge Functions â†’ server
2. Abre el archivo "index.tsx" en el editor
3. Selecciona TODO el contenido (Ctrl+A / Cmd+A)
4. Copia el contenido completo

PASO 2: Renombrar a .ts
------------------------
En el Supabase Dashboard:
1. ELIMINA el archivo "index.tsx" (botÃ³n papelera)
2. CREA un nuevo archivo llamado "index.ts" (no .tsx, sino .ts)
3. PEGA el contenido que copiaste en el Paso 1
4. GUARDA el archivo

PASO 3: Redesplegar la funciÃ³n
-------------------------------
1. En Supabase Dashboard â†’ Edge Functions â†’ server
2. Click en botÃ³n "Deploy" o "Redeploy"
3. Espera confirmaciÃ³n "Deployment successful"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICACIÃ“N
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Test 1: Health Check
---------------------
curl https://ldhimtgexjbmwobkmcwr.supabase.co/functions/v1/server/make-server-05c2b65f/health

Debe devolver: {"status":"ok"}


Test 2: Generador IA desde la aplicaciÃ³n
-----------------------------------------
1. Login: teacher@demo.com / demo123
2. Ir a "Crear Tarea"
3. Click en "Generador de Preguntas con IA" (botÃ³n con Ã­cono âš¡)
4. Pegar este texto de prueba:

   "La fotosÃ­ntesis es el proceso mediante el cual las plantas convierten 
    la luz solar en energÃ­a quÃ­mica. Este proceso ocurre en los cloroplastos, 
    que contienen clorofila, el pigmento que da a las plantas su color verde."

5. Click en "Generar Preguntas"
6. Debe aparecer: "âœ¨ X preguntas generadas con IA de Gemini"


Test 3: Verificar logs (opcional)
----------------------------------
Supabase Dashboard â†’ Edge Functions â†’ server â†’ Logs

No debe haber errores de "504 timeout" ni "403 forbidden"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Â¿POR QUÃ‰ ESTO SOLUCIONA EL PROBLEMA?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Deno (runtime de Supabase Edge Functions) espera:
âœ… Archivos .ts  â†’ TypeScript puro (variables, funciones, tipos)
âœ… Archivos .js  â†’ JavaScript plano

âŒ Archivos .tsx â†’ React TypeScript (componentes JSX)
   â†’ NO FUNCIONAN en Deno/Edge Functions
   â†’ Causan errores 504 timeout en despliegue
   â†’ Las peticiones OPTIONS (CORS preflight) nunca responden

Cuando el archivo es .tsx:
- El servidor NO se despliega correctamente
- Las peticiones hacen timeout despuÃ©s de 150 segundos
- El error 401 aparece porque el servidor mal desplegado no procesa headers

Cuando el archivo es .ts:
- El servidor se despliega correctamente
- CORS funciona (peticiones OPTIONS responden en < 1 segundo)
- AutenticaciÃ³n funciona (headers de Authorization se procesan)
- IA de Gemini funciona (endpoint /ai/generate-questions responde correctamente)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ARCHIVOS CORRECTOS EN /supabase/functions/server/
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… index.ts       â†’ Servidor principal (Hono + todos los endpoints)
âœ… kv_store.ts    â†’ Utilidades para KV store de Supabase
âš ï¸  kv_store.tsx  â†’ (ignorar, el .ts es el que se usa)

El archivo kv_store.tsx estÃ¡ protegido por el sistema, pero no afecta porque
el import usa "./kv_store.ts" explÃ­citamente.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VARIABLES DE ENTORNO REQUERIDAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Verifica en Supabase Dashboard â†’ Settings â†’ Edge Functions â†’ Secrets:

âœ… GEMINI_API_KEY      â†’ Tu clave de Google Gemini API
âœ… SB_URL              â†’ URL de tu proyecto Supabase  
âœ… SB_SERVICE_KEY      â†’ Service Role Key de Supabase

Si falta alguna, aÃ±Ã¡dela desde el Dashboard.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SI USAS SUPABASE CLI (opcional)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si prefieres desplegar desde terminal:

1. AsegÃºrate de tener el archivo renombrado a .ts
2. Ejecuta:
   
   supabase functions deploy server --project-ref ldhimtgexjbmwobkmcwr

3. Espera el mensaje "Deployed function server"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CONTACTO EN CASO DE PROBLEMAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Si despuÃ©s de seguir estos pasos el generador IA sigue sin funcionar:

1. Verifica los logs en Dashboard â†’ Edge Functions â†’ server â†’ Logs
2. Busca errores relacionados con:
   - "GEMINI_API_KEY" â†’ Verifica la clave en Secrets
   - "fetch" o "TypeError" â†’ Verifica que el archivo sea .ts (no .tsx)
   - "CORS" â†’ Verifica que el despliegue fue exitoso

3. Prueba el endpoint directamente con curl:

curl -X POST \
  https://ldhimtgexjbmwobkmcwr.supabase.co/functions/v1/server/make-server-05c2b65f/ai/generate-questions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer demo_token_demo-teacher-1" \
  -d '{
    "text": "La fotosÃ­ntesis es el proceso de las plantas.",
    "maxQuestions": 5,
    "includeCompletarBlancos": true
  }'

Debe devolver un JSON con un array "questions".

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RESUMEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Renombrar: index.tsx â†’ index.ts
âœ… Redesplegar la Edge Function
âœ… Verificar que el health check funciona
âœ… Probar el generador de preguntas IA desde la app

DespuÃ©s de estos pasos, el generador de preguntas con IA de Gemini 
funcionarÃ¡ correctamente.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

#!/bin/bash

# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# SCRIPT DE DESPLIEGUE FINAL - EDUCONNECT
# Funciรณn renombrada: server โ final_server (para evitar cachรฉ)
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ               DESPLEGANDO EDUCONNECT BACKEND - FINAL_SERVER              โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

PROJECT_REF="ldhimtgexjbmwobkmcwr"

echo "๐ฆ Desplegando Edge Function: final_server"
echo "๐ง Project ID: $PROJECT_REF"
echo ""

# Desplegar la funciรณn con el nuevo nombre
npx supabase functions deploy final_server --project-ref $PROJECT_REF

if [ $? -eq 0 ]; then
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ                        โ DESPLIEGUE EXITOSO                              โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "๐ Endpoint disponible en:"
    echo "   https://$PROJECT_REF.supabase.co/functions/v1/final_server/make-server-05c2b65f/"
    echo ""
    echo "๐งช Prueba el health check:"
    echo "   curl https://$PROJECT_REF.supabase.co/functions/v1/final_server/make-server-05c2b65f/health"
    echo ""
    echo "โ Frontend actualizado para usar: /final_server/"
    echo "โ KV Store neutralizado (mock seguro)"
    echo "โ Endpoint de IA: /ai/generate-task (GEMINI_API_KEY)"
    echo ""
    echo "๐ La aplicaciรณn EduConnect estรก lista para usar!"
else
    echo ""
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo "โ                        โ ERROR EN DESPLIEGUE                             โ"
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
    echo ""
    echo "Por favor revisa los logs arriba para mรกs detalles."
    exit 1
fi
